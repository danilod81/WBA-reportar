<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Reporte enviado</title>
  <style>
    :root{
      --bg:#0ea5e9; --bg2:#22c55e; --card:#fff; --text:#0f172a; --sub:#475569;
      --btn:#0ea5e9; --btn-hover:#0284c7; --ring:rgba(14,165,233,.3);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --card:#0b1220; --text:#e2e8f0; --sub:#94a3b8; --btn:#38bdf8;
        --btn-hover:#0ea5e9; --ring:rgba(56,189,248,.35);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 600px at 10% -10%, var(--bg) 0, transparent 60%),
        radial-gradient(1200px 600px at 110% 110%, var(--bg2) 0, transparent 60%),
        #f8fafc;
      display:grid; place-items:center; padding:24px;
    }
    .card{
      width:min(600px,92vw); background:var(--card); color:var(--text);
      border-radius:20px; padding:36px 28px; text-align:center; position:relative;
      box-shadow:0 10px 35px rgba(0,0,0,.08), 0 2px 10px rgba(0,0,0,.06);
      overflow:hidden;
    }
    .emoji{ font-size:56px; line-height:1; margin-bottom:14px; animation:pop .6s ease-out both; }
    @keyframes pop{ 0%{transform:scale(.6);opacity:0} 100%{transform:scale(1);opacity:1} }
    h1{ margin:0 0 6px; font-size:28px; letter-spacing:.2px; }
    p{ margin:6px 0; color:var(--sub) }
    .meta{ margin-top:10px; font-size:14px; }
    .btn{
      display:inline-block; margin-top:22px; background:var(--btn); color:#fff; text-decoration:none;
      padding:12px 18px; border-radius:999px; font-weight:600; box-shadow:0 8px 20px var(--ring);
      transition:transform .06s ease, box-shadow .15s ease, background .2s ease;
    }
    .btn:hover{ background:var(--btn-hover); transform:translateY(-1px) }
    .btn:active{ transform:translateY(0) }
    .hint{ margin-top:14px; font-size:12px; color:var(--sub) }
  </style>
</head>
<body>
  <main class="card" role="main" aria-live="polite">
    <div class="emoji" aria-hidden="true">✅</div>
    <h1>¡Reporte enviado!</h1>
    <p>Tu informe de mantenimiento se registró correctamente.</p>
    <p id="prop" class="meta" hidden>Propiedad: <strong id="propName"></strong></p>

    <!-- El botón vuelve al formulario con los mismos parámetros (incluye reg) -->
    <a id="again" class="btn" href="#">Seguir reportando</a>
    <div class="hint">Se abrirá el mismo formulario con tus datos prellenados.</div>
  </main>

  <script>
    // Lee params actuales
    const urlParams = new URLSearchParams(location.search);

    // 1) Garantizar que 'reg' esté presente:
    //    - Primero intenta desde la URL
    //    - Si no está, recurre a sessionStorage/localStorage (por si el redirect de n8n no lo reenvía)
    let reg = urlParams.get('reg') || sessionStorage.getItem('wba_reg') || localStorage.getItem('wba_reg') || '';

    // Si ahora sí tenemos reg, persistimos para futuras rondas (sesión + persistente)
    if (reg) {
      try { sessionStorage.setItem('wba_reg', reg); } catch {}
      try { localStorage.setItem('wba_reg', reg); } catch {}
    }

    // 2) Mostrar propiedad si viene en QS
    const dep = urlParams.get('departamento') || urlParams.get('depto') || '';
    if (dep) {
      document.getElementById('propName').textContent = dep;
      document.getElementById('prop').hidden = false;
    }

    // 3) Armar QS de regreso: preserva todos los parámetros que vengan,
    //    forzando que 'reg' esté presente si lo conseguimos por fallback.
    const backParams = new URLSearchParams(urlParams);
    if (reg && !backParams.get('reg')) backParams.set('reg', reg);

    const backHref = 'reportar-mantenimiento.html' + (backParams.toString() ? '?' + backParams.toString() : '');
    const a = document.getElementById('again');
    a.href = backHref;

    // Accesibilidad: foco al botón
    window.requestAnimationFrame(() => a.focus());
  </script>

  <noscript>
    <div style="text-align:center;margin-top:8px;color:#6b7280">
      Si el botón no funciona, volvé al formulario manualmente.
    </div>
  </noscript>
</body>
</html>
